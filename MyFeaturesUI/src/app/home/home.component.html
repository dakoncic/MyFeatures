<div class="flex flex-column" style="height: 100%">
  <div class="grid">
    <div class="col-12">
      <div class="card px-6 py-6">
        <p-toolbar styleClass="mb-4">
          <ng-template pTemplate="left">
            <div class="my-2">
              <button
                pButton
                pRipple
                label="New"
                icon="pi pi-plus"
                class="p-button-success mr-2"
                (click)="openNew()"
              ></button>
            </div>
          </ng-template>
        </p-toolbar>

        <p-table
          [value]="(items$ | async)!"
          [columns]="cols"
          [rowHover]="true"
          dataKey="id"
        >
          <ng-template pTemplate="caption">
            <div
              class="flex flex-column md:flex-row md:justify-content-between md:align-items-center"
            >
              <h5 class="m-0">Manage Items</h5>
            </div>
          </ng-template>

          <ng-template pTemplate="header" let-columns=>
            <tr>
              <th scope="col" *ngFor="let col of columns">
                {{ col.header }}
              </th>
              <!-- 1 header za custom kolone -->
              <th scope="col"></th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-rowData let-columns="columns">
            <tr>
              <td *ngFor="let col of columns">
                <span>{{ rowData[col.field] }}</span>
              </td>

              <td>
                <div class="flex justify-content-end">
                  <button
                    pButton
                    pRipple
                    icon="pi pi-check"
                    class="p-button-rounded p-button-info mr-2"
                    (click)="completeItem(rowData)"
                  ></button>
                  <button
                    pButton
                    pRipple
                    icon="pi pi-pencil"
                    class="p-button-rounded p-button-success mr-2"
                    (click)="editItem(rowData)"
                  ></button>
                  <button
                    pButton
                    pRipple
                    icon="pi pi-trash"
                    class="p-button-rounded p-button-warning"
                    (click)="deleteItem(item.id!)"
                  ></button>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>

      <!-- ovaj visible sam update-a editDialogVisible
      kad se dialog zatvori -->
      <p-dialog
        [(visible)]="editDialogVisible"
        [style]="{ width: '450px', height: '1000px' }"
        header="Item Details"
        [modal]="true"
        class="p-fluid"
      >
        <ng-template pTemplate="content">
          <form [formGroup]="form">
            <div class="field">
              <label for="description">Description</label>
              <input
                type="text"
                pInputText
                id="name"
                formControlName="description"
                autofocus
                [ngClass]="{ 'ng-invalid ng-dirty': description?.invalid && description?.dirty }"
              />
              <small *ngIf="description?.invalid && description?.dirty" class="ng-dirty ng-invalid"
              >
                Description is required.
              </small>
            </div>

            <div class="field">
              <label for="oneTimeTask">To do only once?</label>
              <p-selectButton [options]="stateOptions" formControlName="oneTimeTask" optionLabel="label" optionValue="value"

              >
              </p-selectButton>
            </div>

            <div class="field">
              <label for="dueDate">Must be completed by certain date? </label>
              <p-calendar formControlName="dueDate" [showButtonBar]="true"></p-calendar>
            </div>

            <div class="field">
              <label for="daysBetweenRepeat">How many days between task repeats? </label>
              <p-inputNumber
                formControlName="daysBetweenRepeat"
                [ngClass]="{ 'ng-invalid ng-dirty': description?.invalid && description?.dirty }"
              >
              </p-inputNumber>
              <small *ngIf="daysBetweenRepeat?.invalid && daysBetweenRepeat?.dirty" class="ng-dirty ng-invalid"
              >
                Days between repeat is required.
              </small>
            </div>
          </form>
        </ng-template>

        <ng-template pTemplate="footer">
          <button
            pButton
            pRipple
            label="Cancel"
            icon="pi pi-times"
            class="p-button-text"
            (click)="hideDialog()"
          ></button>
          <button
            pButton
            pRipple
            label="Save"
            icon="pi pi-check"
            class="p-button-text"
            (click)="saveItem()"
          ></button>
        </ng-template>
      </p-dialog>

      <p-dialog
        [(visible)]="deleteDialogVisible"
        header="Confirm"
        [modal]="true"
        [style]="{ width: '450px' }"
      >
        <div class="flex align-items-center justify-content-center">
          <i
            class="pi pi-exclamation-triangle mr-3"
            style="font-size: 2rem"
          ></i>
          <span *ngIf="item">
            Are you sure you want to delete this item?
          </span>
        </div>
        <ng-template pTemplate="footer">
          <button
            pButton
            pRipple
            icon="pi pi-times"
            class="p-button-text"
            label="No"
            (click)="deleteDialogVisible = false"
          ></button>
          <button
            pButton
            pRipple
            icon="pi pi-check"
            class="p-button-text"
            label="Yes"
            (click)="confirmDelete()"
          ></button>
        </ng-template>
      </p-dialog>
    </div>
  </div>
</div>
